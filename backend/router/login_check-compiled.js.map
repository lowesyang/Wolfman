{"version":3,"sources":["login_check.js"],"names":[],"mappings":"AAAA,IAAI,SAAO,QAAQ,SAAR,EAAmB,MAAnB,EAAX;AACA,IAAI,SAAO,QAAQ,UAAR,CAAX;AACA,IAAI,SAAO,OAAO,EAAlB;IACI,UAAQ,OAAO,OADnB;;AAIA,OAAO,GAAP,CAAW,GAAX,EAAe,UAAS,GAAT,EAAa,GAAb,EAAiB,IAAjB,EAAsB;AACjC,QAAI,QAAM,IAAI,IAAJ,CAAS,KAAnB;AACA,QAAG,SAAO,OAAP,IAAkB,SAAO,UAA5B,EAAwC,OAAO,MAAP;AACxC,QAAG;AACC,YAAI,UAAQ,QAAQ,KAAR,CAAZ;AACH,KAFD,CAGA,OAAM,GAAN,EAAU;AACN,eAAO,IAAI,IAAJ,CAAS;AACZ,kBAAK,CAAC,CADM;AAEZ,iBAAI;AAFQ,SAAT,CAAP;AAIH;;AAED,QAAI,WAAS,QAAQ,QAArB;AACA,WAAO,KAAP,CAAa,sCAAb,EAAoD,CAAC,QAAD,CAApD,EAA+D,UAAS,GAAT,EAAa,IAAb,EAAkB;AAC7E,YAAG,GAAH,EAAO;AACH,mBAAO,IAAI,IAAJ,CAAS;AACZ,sBAAK,CADO;AAEZ,qBAAI,IAAI,QAAJ;AAFQ,aAAT,CAAP;AAIH;AACD,YAAG,KAAK,CAAL,CAAH,EAAW;AACP,gBAAI,KAAJ,GAAU,KAAV,C;AACA;AACH,SAHD,MAII;AACA,mBAAO,IAAI,IAAJ,CAAS;AACZ,sBAAK,CAAC,CADM;AAEZ,qBAAI;AAFQ,aAAT,CAAP;AAIH;AACJ,KAjBD;AAkBH,CAhCD;;AAkCA,OAAO,OAAP,GAAe,MAAf","file":"login_check-compiled.js","sourcesContent":["var router=require(\"express\").Router();\r\nvar config=require(\"./config\");\r\nvar client=config.db,\r\n    decrypt=config.decrypt;\r\n\r\n\r\nrouter.all('*',function(req,res,next){\r\n    var token=req.body.token;\r\n    if(token==\"login\" || token==\"register\") return next();\r\n    try{\r\n        var decoded=decrypt(token);\r\n    }\r\n    catch(err){\r\n        return res.json({\r\n            code:-1,\r\n            msg:\"身份认证失败，请重新登录!\"\r\n        })\r\n    }\r\n\r\n    var userName=decoded.userName;\r\n    client.query(\"select * from users where userName=?\",[userName],function(err,data){\r\n        if(err){\r\n            return res.json({\r\n                code:1,\r\n                msg:err.toString()\r\n            })\r\n        }\r\n        if(data[0]){\r\n            req.token=token;    //保存在req对象中\r\n            next();\r\n        }\r\n        else{\r\n            return res.json({\r\n                code:-1,\r\n                msg:\"身份认证失败，请重新登录!\"\r\n            })\r\n        }\r\n    })\r\n})\r\n\r\nmodule.exports=router;"]}